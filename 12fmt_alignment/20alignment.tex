% !TEX root = ../main.tex
\subsection{FMT Alignment}
\label{12.20::fmt_alignment}
% --+ Why is it needed +--------------------------------------------------------
    In an ideal scenario, the target and each detector would be installed precisely in their required positions.
    However, in the real world, there are inevitable misalignments in their placements.
    These misalignments must be accounted for and incorporated into the reconstruction process to ensure meaningful results.

    Within the CLAS collaboration, the Calibration and Commissioning group is responsible for the alignment and calibration of each detector.
    The shifts and rotations necessary for alignment are included in the Calibration and Conditions Database (CCDB), which is then utilised during reconstruction.

    The alignment work aimed to achieve three primary goals.
    Firstly, to provide FMT alignment tables to Run Group F (RG-F) for use in reconstruction.
    Secondly, to assess whether the resolution improvement obtained from the FMT justifies the additional material introduced into the CLAS12 detector.
    Lastly, to offer detailed information about these improvements, enabling Run Group E (RG-E) and other run groups to make informed decisions on whether to include the detector in their runs.

% --+ Definitions +-------------------------------------------------------------
    Alignment shifts can be performed in any of the three global axes: $z$, which is aligned with the beamline; $x$, which runs parallel to the ground; and $y$, which points upwards from the ground.
    Additionally, alignment rotations can be carried out around these axes.
    Specifically, for the purposes of this work, rotations around the $z$ axis are referred to as $\phi$ rotation (roll), while rotations around the $x$ and $y$ axes are termed pitch and yaw, respectively.

    To quantify misalignment, the DOCA between a reconstructed DC track and an FMT cluster is defined as a Residual.
    Due to the geometry of each layer (as depicted in Figure \ref{fig::12.10::fmt_geometry}), only the residuals in the local $y$ axis of a layer (perpendicular to the strips) can be measured.
    This implies that global $z$ and $\phi$ alignment can be performed independently for each layer.
    However, global $x$, global $y$, pitch, and yaw alignment must be carried out simultaneously for the entire detector.

% --+ How was it done +---------------------------------------------------------
    \begin{figure}[b!]
        \includegraphics[width=\textwidth]{20res_example.png}
        \caption[Example FMT residuals plot]
        {Example Forward Micromegas Tracker (FMT) residuals plot.}
        \floatfoot{Source: Own elaboration, using \href{https://github.com/JeffersonLab/clas12alignment}{CLAS12 alignment software}.}
        \label{fig::12.20::fmt_residuals_example}
    \end{figure}

    To minimise residuals, they are plotted for a specific shift or rotation in the relevant axes.
    An example of such a plot is illustrated in Figure \ref{fig::12.20::fmt_residuals_example}.
    Since the residuals are expected to follow a Gaussian distribution, a Gaussian fit is applied to them.

    For $z$ and $\phi$ alignment, the goodness of fit is heuristically evaluated by comparing the standard deviation ($\sigma$) of the Gaussian fits and selecting the shift with the smallest $\sigma$.
    For $x$, $y$, pitch, and yaw alignment, the goodness of fit is heuristically evaluated by choosing the fit with the mean closest to zero.
    It is important to consider a reasonable error margin when selecting the minima.

    Examples of the distributions of goodness of fit for $z$ and $xy$ alignment can be observed in Figure \ref{fig::12.20::fmt_residuals_fit_example}.

    \begin{figure}[t!]
        \includegraphics[width=\textwidth]{20resfit_example.png}
        \caption[Examples of residuals goodness of fit plots]
        {Examples of residuals goodness of fit plots.}
        \floatfoot{Source: Own elaboration, using \href{https://github.com/JeffersonLab/clas12alignment}{CLAS12 alignment software}.}
        \label{fig::12.20::fmt_residuals_fit_example}
    \end{figure}

    \input{12fmt_alignment/21fiducial_cuts}
    \input{12fmt_alignment/22residuals_improvement}

    The procedure described in this section is documented and shared publicly.
    It can be seen at

    \href{https://github.com/JeffersonLab/clas12alignment/tree/master/fmt}{\texttt{github.com/JeffersonLab/clas12alignment/tree/master/fmt}}
