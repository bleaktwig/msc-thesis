% !TEX root = ../main.tex
\subsubsection{\texttt{make\_ntuples}}
    This executable runs over one or more files generated by \texttt{hipo2root} and saves a ROOT file containing a set of ntuples of physical interest.
    In addition, based on the requirements for this thesis' analysis, the executable generates two sets of ntuples.
    Both sets contain the same ntuple format, but the former uses only DC tracking data while the latter uses DC and FMT tracking data.
    
    For each event, the program executes the following algorithm:
    
    \begin{enumerate}
        \item
            First, the TOF of the trigger electron is to be found.
            The trigger electron's hits in the FD scintillators and FD calorimeters are listed in order of priority.
            This priority comes from the precision of each detector's TOF measurement.
            In order of precision, the detectors list is FTOF panel-1b (FTOF1B), FTOF panel-1a (FTOF1A), FTOF panel-2 (FTOF2), Pre-shower Calorimeter (PCAL), ECIN, ECOU, as described in section \ref{sssec::forwarddetector}.
            Then, the list of hits is simply iterated over, extracting the TOF from the earliest hit of the most precise layer available.
    
        \item
            Then, for each track available two particle objects is instantiated.
            This object contains the particle's relevant data: it's vertex position, vertex momentum, charge, beta, and the CLAS12 sector where it passed through.
            The first object corresponds to tracking data obtained by DC, while the second to DC and FMT.
            The particle's PID will be assigned later in the process.
            
        \item
            The particle's deposited energy in the calorimeters is computed and stored.
            This simply means adding the energy deposited by all the hits associated to the particle's track, for each calorimeter.
        
        \item
            The particle's number of produced photoelectrons in HTCC and LTCC is counted.
            Additionally, its TOF is computed, following the same procedure as the one for the trigger electron's TOF.
        
        \item
            The particle's PID is assigned.
            The process is very similar to the assignment of PID in reconstruction, which is described in section \ref{sssec::offlinereconstruction}.
            However, this PID is not directly used, to allow the user to modify the parameters and define new criteria to assign PID.

            While this process gives almost always the same result as reconstruction, there is a slight error in the PID assignment.
            This error is expressed in table \ref{tab::mpid}.
            As can be seen on the table, some kaons and protons are misidentified as pions, but not to a large degree.
            Apart from that, all identification is ideal.
            
            \begin{table}
                \caption{Particle identification matrix for the FD.
                The rows show the PID assigned by reconstruction while the columns the one assigned by the \texttt{make\_ntuples} program.
                The diagonal elements are correctly identified, while the off-diagonal elements are misidentified.}

                \begin{center}
                    \begin{tabularx}{240pt}{X|llllll}
                        \cline{2-7}
                                 & $e$      & $\pi$ & $K$  & $p$  & $n$  & $\gamma$ \\
                        \hline
                        $e$      & 1.00     &       &      &      &      &          \\
                        $\pi$    &          & 1.00  & 0.09 & 0.02 &      &          \\
                        $K$      &          &       & 0.91 &      &      &          \\
                        $p$      &          &       &      & 0.98 &      &          \\
                        $n$      &          &       &      &      & 1.00 &          \\
                        $\gamma$ &          &       &      &      &      & 1.00     \\
                        \hline
                    \end{tabularx}
                \end{center}
                \label{tab::mpid}
            \end{table}

        \item
            Finally, two \texttt{ntuples} objects are created: One from the particle generated from DC tracking data and another for the one from DC plus FMT data.
            These are saved in an output file, which can be used directly for analysis, or processed by the \texttt{draw\_plots} program from the next section.
    \end{enumerate}

    The manual entry of the program is:
    \begin{lstlisting}
Usage: make_ntuples [-hDn:w:d:] infile
 * -h         : show this message and exit.
 * -D         : activate debug mode.
 * -n nevents : number of events.
 * -f         : set this to true to process FMT::Tracks bank.
 * -w workdir : location where output root files are to be stored. Default is root_io.
 * -d datadir : location where sampling fraction files are located. Default is data.
 * infile     : input ROOT file. Expected file format: <text>run_no.root`.

Generate ntuples relevant to SIDIS analysis based on the reconstructed variables from CLAS12 data. The output of the program is the `ntuples_<run_no>.root` file, which contains all relevant ntuples for RG-E analysis. This file can be studied directly in root or through the `draw_plots` program.
    \end{lstlisting}